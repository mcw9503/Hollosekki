<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="recipeMapper">

	<insert id="insertRecipe">
		insert into recipe values(seq_recipe_no.nextval, #{usersNo}, #{recipeName}, #{categoryIngredient},
								  #{categorySituation}, #{categoryType}, #{recipeDifficulty}, #{recipeTime},
								  #{recipeContent}, #{recipeOrder}, default, default, default, default)
	</insert>
	
	<insert id="insertAttm">
		insert all
		<foreach collection="list" item="item"> 
			into image values(new_image_no,
			<if test="item.imageDivideNo == 0">
			SEQ_RECIPE_NO.currval,
			</if>
			<if test="item.imageDivideNo != 0">
			#{item.imageDivideNo},
			</if>
			 2, #{item.imageOriginalName}, #{item.imageRenameName}, #{item.imagePath}, ${item.imageLevel})
		</foreach>
		select * from dual
	</insert>
	
	<select id="getListCount" resultType="_int">
		select count(*)
		from recipe
	</select>
	
	<select id="selectRecipeList" resultMap="recipeResultSet">
		select *
		from recipe
			 join users using(users_no)
		where recipe_status = 'Y'
		order by food_no desc
	</select>
	
	<select id="selectRecipeImageList" resultMap="imageResultSet">
		select *
		from image
		where image_type = 2 and image_level = 0
		order by image_no desc
	</select>
	
	<select id="recipeDetail" resultMap="recipeResultSet">
		select *
		from recipe
			 join users using(users_no)
		where food_no = #{foodNo} and recipe_status='Y'
	</select>
	
	<update id="addCount">
		update recipe set recipe_count = recipe_count + 1
		where food_no=#{foodNo}
	</update>
	
	<select id="recipeDetailThum" resultMap="imageResultSet">
		select *
		from image
		where image_Divide_No = #{foodNo} and image_Level=0
	</select>
	
	<select id="recipeDetailOrder" resultMap="imageResultSet">
		select *
		from image
		where image_Divide_No = #{foodNo} and image_Level=1
	</select>
	
	<select id="recipeDetailComp" resultMap="imageResultSet">
		select *
		from image
		where image_Divide_No = #{foodNo} and image_Level=2	
	</select>
	
		
	<resultMap type="Recipe" id="recipeResultSet">
		<id column="food_no" property="foodNo"/>
		<result column="USERS_NO" property="usersNo"/>
		<result column="RECIPE_NAME" property="recipeName"/>
		<result column="CATEGORY_INGREDIENT" property="categoryIngredient"/>
		<result column="CATEGORY_SITUATION" property="categorySituation"/>
		<result column="CATEGORY_TYPE" property="categoryType"/>
		<result column="RECIPE_DIFFICULTY" property="recipeDifficulty"/>
		<result column="RECIPE_TIME" property="recipeTime"/>
		<result column="RECIPE_CONTENT" property="recipeContent"/>
		<result column="RECIPE_ORDER" property="recipeOrder"/>
		<result column="RECIPE_COUNT" property="recipeCount"/>
		<result column="RECIPE_CREATE_DATE" property="recipeCreateDate"/>
		<result column="RECIPE_MODIFY_DATE" property="recipeModifyDate"/>
		<result column="RECIPE_STATUS" property="recipeStatus"/>
		<result column="users_id" property="usersId"/>
		<result column="nickname" property="nickName"/>
	</resultMap>
	
	<resultMap type="Image" id="imageResultSet">
		<id column="IMAGE_NO" property="imageNo"/>
		<result column="IMAGE_DIVIDE_NO" property="imageDivideNo"/>
		<result column="IMAGE_TYPE" property="imageType"/>
		<result column="IMAGE_ORIGINALNAME" property="imageOriginalName"/>
		<result column="IMAGE_RENAMENAME" property="imageRenameName"/>
		<result column="IMAGE_PATH" property="imagePath"/>
		<result column="IMAGE_LEVEL" property="imageLevel"/>
	</resultMap>
</mapper>
