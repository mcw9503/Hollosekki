<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="marketMapper">
	<update id="attendanceCheck">
		update users
		set attendance_date = #{attendanceDate}
		where users_id = #{uId}
	</update>
	
	<update id="aDateCheck">
		update users
		set check_day = (select count(dateStr)
		                from attendance
		                where users_id = #{u.usersId})
		where users_id = #{u.usersId}
	</update>
	
	
	<select id="atTodayChecked" resultType="_int">
		 select count(*)
		 from attendance
		 where users_id = #{usersId}
		 	   and dateStr = checked
	</select>
	
	
	<resultMap type="Users" id="UsersResultSet">
		<id column="USERS_NO" property="usersNo"/>
		<result column="USERS_ID" property="usersId"/>
		<result column="USERS_PW" property="usersPw"/>
		<result column="USERS_NAME" property="usersName"/>
		<result column="NICKNAME" property="nickname"/>
		<result column="EMAIL" property="email"/>
		<result column="PHONE" property="phone"/>
		<result column="ENROLL_DATE" property="enrollDate"/>
		<result column="EXIT_DATE" property="exitDate"/>
		<result column="STATUS" property="status"/>
		<result column="CHECK_DAY" property="checkDay"/>
		<result column="POINT" property="point"/>
		<result column="IS_ADMIN" property="isAdmin"/>
		<result column="ATTENDANCE_DATE" property="attendanceDate"/>
		<result column="ATTENDANCE_DAY" property="attendanceDay"/>
	</resultMap>
	
	<insert id="atInsert">
	    insert into attendance (USERS_ID, DATE1, DATESTR, CHECKED, TITLE)
	    values (#{u.usersId}, #{at.date}, #{at.dateStr}, to_char(sysdate, 'YYYY-MM-DD'), #{at.title})
	</insert>
	
	
	<insert id="insertShipping">
  		insert into shipping_address (USERS_NO, RECIPIENT, ADDRESS, HOME_PHONE, PHONE, SHIPPING_NO, SHIPPING_NAME)
  		values (#{usersNo}, #{recipient}, #{address}, #{homePhone}, #{phone}, SEQ_SHIPPING_ADDRESS.nextval, #{shippingName})
	</insert>
	
	<insert id="insertCart">
		INSERT INTO CART
		VALUES (SEQ_CART_NO.NEXTVAL, ${1}, #{productNo}, #{productOption}, #{cartCount} )
	</insert>
	
	<select id="allAt" resultMap="AttendanceResultSet">
		select
		    *
		from
		    attendance
		where
		    users_id = #{usersId}
	</select>
	
	<resultMap type="Attendance" id="AttendanceResultSet">
		<id column="USERS_ID" property="usersId"/>
		<result column="DATE1" property="date"/>
		<result column="DATESTR" property="dateStr"/>
		<result column="CHECKED" property="checked"/>
		<result column="TITLE" property="title"/>
		<result column="POINT" property="point"/>
	</resultMap>
	
	<update id="gettedPoint">
		update users
		set point = #{u.point} + 10
		where users_id = #{u.usersId}
	</update>
	
<!-- 	<select id="selectShipping" resultMap="shipAddress"> -->
<!-- 		select * -->
<!-- 		from shipping_address -->
<!-- 		where users_no = #{usersNo} -->
<!-- 	</select> -->
	
<!-- 	<resultMap type="ShippingAddress" id="shipAddress"> -->
<!-- 		<result column="USERS_NO" property="usersNo"/> -->
<!-- 		<result column="RECIPIENT" property="recipient"/> -->
<!-- 		<result column="ADDRESS" property="address"/> -->
<!-- 		<result column="HOME_PHONE" property="homePhone"/> -->
<!-- 		<result column="PHONE" property="phone"/> -->
<!-- 		<result column="SHIPPING_NO" property="shippingNo"/> -->
<!-- 		<result column="SHIPPING_NAME" property="shippingName"/> -->
		
<!-- 	</resultMap> -->
</mapper>